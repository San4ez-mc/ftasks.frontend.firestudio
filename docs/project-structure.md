# Специфікація структури проєкту FINEKO

Цей документ описує стандартну та рекомендовану структуру файлів та папок для проєкту FINEKO. Мета — забезпечити консистентність, масштабованість та простоту навігації по кодовій базі.

## 1. Основні принципи

- **Next.js App Router:** Структура повністю базується на конвенціях App Router.
- **Групування маршрутів (Route Groups):** Ми активно використовуємо групи `(app)` та `(auth)` для застосування різних макетів до різних частин додатку.
- **Розділення логіки:** Чітке розділення між клієнтськими компонентами, серверними діями, API-маршрутами та бізнес-логікою.
- **Модульність:** Функціонал, що стосується певної сутності (напр., "Задачі"), групується разом.

---

## 2. Структура директорій

```
src
├── app
│   ├── (app)                   # -> Основні сторінки додатку (з макетом)
│   │   ├── audit
│   │   ├── company
│   │   ├── instructions
│   │   ├── org-structure
│   │   ├── processes
│   │   ├── results
│   │   ├── settings
│   │   ├── tasks
│   │   ├── templates
│   │   ├── layout.tsx          # -> Основний макет (AppShell) з хедером і сайдбаром
│   │   └── page.tsx            # -> Головна сторінка (редирект або щоденні задачі)
│   │
│   ├── (auth)                  # -> Сторінки автентифікації (без макету)
│   │   ├── auth
│   │   ├── create-company
│   │   ├── login
│   │   ├── select-company
│   │   └── layout.tsx          # -> Мінімальний макет для сторінок входу
│   │
│   ├── api                     # -> API-маршрути (проксі до зовнішнього бекенду)
│   │   └── auth
│   │       ├── companies
│   │       ├── create-company
│   │       ├── me
│   │       └── select-company
│   │
│   ├── layout.tsx              # -> Кореневий макет (додає ThemeProvider, Toaster)
│   └── globals.css             # -> Глобальні стилі та змінні Tailwind CSS
│
├── ai                          # -> Все, що стосується Genkit AI
│   ├── flows                   # -> AI-потоки (напр., для аудиту)
│   ├── genkit.ts               # -> Ініціалізація Genkit
│   └── types.ts                # -> Схеми Zod та типи для AI
│
├── components                  # -> Перевикористовувані React-компоненти
│   ├── ui                      # -> Базові UI-компоненти (shadcn/ui: Button, Card, etc.)
│   ├── layout                  # -> Компоненти макету (Header, SidebarNav, AppShell)
│   └── [feature]               # -> Компоненти для конкретної фічі (e.g., /tasks, /results)
│
├── data                        # -> Статичні дані, моки
│
├── hooks                       # -> Кастомні React хуки (e.g., use-toast)
│
├── lib                         # -> Основна бізнес-логіка, утиліти та сервіси
│   ├── api.ts                  # -> КЛІЄНТСЬКІ функції для виклику наших /api-маршрутів
│   ├── firebase-admin.ts       # -> Ініціалізація Firebase Admin SDK (сервер)
│   ├── firestore-service.ts    # -> СЕРВЕРНІ функції для роботи з Firestore
│   ├── session.ts              # -> СЕРВЕРНА логіка для роботи з сесіями (cookie)
│   ├── telegram-service.ts     # -> СЕРВЕРНІ функції для роботи з Telegram API
│   └── utils.ts                # -> Загальні утиліти (cn, formatDate, etc.)
│
├── middleware.ts               # -> Middleware для перевірки автентифікації
│
└── types                       # -> Глобальні TypeScript типи для сутностей
    ├── task.ts
    ├── result.ts
    ├── company.ts
    └── ...
```

---

## 3. Деталізація по директоріях

### `src/app/(app)`
- **Призначення:** Основний робочий простір користувача.
- **`layout.tsx`** в цій групі підключає `AppShell`, який містить сайдбар та хедер.
- Кожна папка всередині відповідає за окремий розділ додатку (наприклад, `/results`, `/company`).
- Кожен розділ може мати свій `page.tsx` та `actions.ts` (файл з серверними діями для цієї сторінки).

### `src/app/(auth)`
- **Призначення:** Сторінки для входу, реєстрації, вибору компанії.
- **`layout.tsx`** тут максимально простий, без сайдбару та хедера.
- Ці сторінки не повинні показувати основний інтерфейс додатку, поки користувач не увійшов в систему.

### `src/app/api`
- **Призначення:** "Проксі" для зовнішнього PHP-бекенду.
- **Безпека:** Це єдине місце, звідки мають йти запити на зовнішній API. Це дозволяє приховати секретні ключі та керувати сесіями на стороні Next.js сервера.
- **Структура:** Рекомендується групувати маршрути за сутністю. Наприклад, всі маршрути для автентифікації знаходяться в `/api/auth/`.

### `src/lib`
- **`api.ts` (Клієнт):** Містить функції, які викликаються з клієнтських компонентів для доступу до даних. Ці функції звертаються **тільки** до наших внутрішніх маршрутів в `/app/api`.
- **`firestore-service.ts` (Сервер):** Містить функції, які працюють безпосередньо з базою даних Firestore на сервері. Вони викликаються з `actions.ts` або з `route.ts` (API-маршрутів).
- **`session.ts` (Сервер):** Допоміжні функції для роботи з `auth_token` cookie.

### `src/types`
- **Призначення:** Централізоване зберігання всіх типів даних.
- **Правило:** Один файл на одну логічну сутність (напр., `task.ts` для всього, що пов'язано з задачами). Це спрощує імпорт та керування типами.
