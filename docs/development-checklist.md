# Чек-лист розробки та часті помилки

Цей документ містить список найчастіших помилок, які виникали під час розробки, та слугує чек-листом для перевірки перед фіналізацією змін.

## 1. Робота з Firestore

### 1.1. Індекси для запитів
- **Проблема:** Запити до Firestore (наприклад, `db.collection('users').where('telegramUserId', '==', id).get()`) можуть "зависати" або обриватися за таймаутом у серверному середовищі, якщо для поля, по якому йде пошук, не створено відповідний індекс.
- **Рішення:** Завжди перевіряти, що для полів, які використовуються в `.where()`, існує відповідний індекс в консолі Firebase.
- **Чек-лист:**
    - [ ] Для колекції `users` існує single-field індекс для поля `telegramUserId`.
    - [ ] Для нових запитів `.where()` створено відповідні індекси.

## 2. Директива `'use server'` в Next.js

### 2.1. Правильне розміщення
- **Проблема:** Неправильне використання директиви `'use server'` на початку файлу може призвести до помилок збірки (`Build failed`). Next.js починає висувати до всіх експортованих функцій з цього файлу суворі вимоги, які призначені лише для "серверних дій", що викликаються з клієнта.
- **Рішення:**
    - Директиву `'use server'` слід розміщувати **тільки** у файлах, які експортують функції, що безпосередньо викликаються з клієнтських компонентів (зазвичай це файли типу `actions.ts`).
    - Допоміжні бібліотеки, сервіси та утиліти, які використовуються *всередині* серверних дій (наприклад, `firestore-service.ts`, `firebase-admin.ts`), **не повинні** містити `'use server'`. Вони і так виконуються лише на сервері.
- **Чек-лист:**
    - [ ] Файли `src/lib/firebase-admin.ts` та `src/lib/firestore-service.ts` не містять `'use server'`.
    - [ ] Директива `'use server'` присутня у всіх файлах `actions.ts`, які викликаються з клієнтських компонентів.

## 3. Структура проєкту

### 3.1. Дублювання коду в `workspace`
- **Проблема:** Наявність дубльованої папки `workspace` може призводити до неочевидних помилок збірки, коли система компілює старі або неправильні версії файлів.
- **Рішення:** Намагатись підтримувати синхронність між `src` та `workspace`, а в ідеалі — працювати над усуненням дублювання.
- **Чек-лист:**
    - [ ] Зміни, внесені до файлів у `src`, синхронізовані з аналогічними файлами у `workspace`.
