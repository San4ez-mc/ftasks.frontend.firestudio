# Документація API

Цей документ надає детальний огляд кінцевих точок (ендпоінтів) API, доступних у додатку PHP-Audit.

## Автентифікація

Усі кінцеві точки API (за винятком `/companies/create` та вебхука Telegram) вимагають `Bearer` токен для автентифікації. Токен необхідно передавати в заголовку `Authorization`.

**Приклад заголовка:**
```
Authorization: Bearer <ваш_jwt_токен>
```

JWT токен видається після успішного входу через Telegram-бота. Детальніше дивіться у [Схемі входу](./login-flow.md).

---

## Кінцеві точки (Endpoints)

### 1. Створити нову компанію

Створює нову компанію в системі.

**Примітка:** Наразі ця кінцева точка є публічною і не вимагає автентифікації. У робочому середовищі доступ до неї має бути обмежений лише для супер-адміністраторів.

- **Ендпоінт:** `POST /companies/create`
- **Метод:** `POST`
- **Тіло запиту:**

  ```json
  {
    "name": "Нова Чудова Компанія"
  }
  ```

- **Успішна відповідь (201 Created):**

  ```json
  {
    "status": "success",
    "message": "Компанію успішно створено.",
    "company_id": "2"
  }
  ```

- **Відповіді з помилками:**
  - `400 Bad Request`: Якщо поле `name` відсутнє або порожнє.
  - `409 Conflict`: Якщо компанія з такою назвою вже існує.

---

### 2. Отримати організаційну структуру

Отримує повну ієрархічну структуру компанії, пов'язаної з автентифікованим користувачем.

- **Ендпоінт:** `GET /org-structure`
- **Метод:** `GET`
- **Успішна відповідь (200 OK):**

  Масив відділів. Кожен відділ містить свої секції та користувачів.

  ```json
  [
    {
      "id": 1,
      "name": "ІТ-відділ",
      "sections": [
        {
          "id": 1,
          "name": "Розробка",
          "users": [
            {
              "id": 1,
              "full_name": "Admin User"
            }
          ]
        }
      ]
    }
  ]
  ```

- **Відповіді з помилками:**
  - `401 Unauthorized`: Якщо токен відсутній або недійсний.
  - `403 Forbidden`: Якщо з токеном користувача не пов'язана жодна компанія.

---

### 3. Створити нову задачу

Створює нову задачу в компанії користувача.

- **Ендпоінт:** `POST /tasks/create`
- **Метод:** `POST`
- **Тіло запиту:**

  ```json
  {
    "title": "Виправити помилку входу",
    "assignee_id": 2
  }
  ```

- **Успішна відповідь (201 Created):**

  ```json
  {
    "status": "success",
    "task_id": "1"
  }
  ```

- **Відповіді з помилками:**
  - `400 Bad Request`: Якщо `title` або `assignee_id` відсутні чи недійсні.
  - `401 Unauthorized`: Якщо токен відсутній або недійсний.
  - `404 Not Found`: Якщо вказаний `assignee_id` не існує в компанії користувача.

---

### 4. Отримати задачі

Отримує список задач для компанії користувача. Можна фільтрувати за `assignee_id`.

- **Ендпоінт:** `GET /tasks/get`
- **Метод:** `GET`
- **Параметри запиту (необов'язкові):**
  - `assignee_id`: Фільтрує задачі за ID призначеного користувача.

- **Успішна відповідь (200 OK):**

  Масив об'єктів задач.

  ```json
  [
    {
      "id": 1,
      "title": "Виправити помилку входу",
      "assignee_name": "Tester One",
      "reporter_name": "Admin User"
    }
  ]
  ```

- **Відповіді з помилками:**
  - `401 Unauthorized`: Якщо токен відсутній або недійсний.